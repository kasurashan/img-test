name: Slack Reminder - Research Progress

# 🔁 2주마다 화요일 오전 4시 UTC (KST 기준 오후 1시)
# 예: 매달 1주차 화요일과 3주차 화요일 등
on:
  schedule:
    - cron: '0 4 1-7 * 2'     # 첫째 주 화요일 13:00 KST
    - cron: '0 4 15-21 * 2'   # 셋째 주 화요일 13:00 KST
  workflow_dispatch:          # 수동 실행도 허용

jobs:
  post-to-slack:
    runs-on: ubuntu-latest
    steps:
      - name: Send reminder to Slack
        env:
          SLACK_TOKEN: ${{ secrets.SLACK_TOKEN_AIM_LAB }}
          TZ: Asia/Seoul
        run: |
          IMAGE_URL="https://raw.githubusercontent.com/kasurashan/slack-reminder/main/Cap%202025-04-25%2001-36-30-538.jpg"

          cat <<EOF > payload.json
          {
            "channel": "#research-progress",
            "text": "You're welcome to upload to the Method Archive anytime—uploads usually happen after a research cycle, but we're always happy to see what you've got!",
            "attachments": [
              {
                "fallback": "슬랙 리마인더 이미지",
                "image_url": "$IMAGE_URL",
                "text": ""
              }
            ]
          }
          EOF

          curl -s -X POST \
            -H "Authorization: Bearer $SLACK_TOKEN" \
            -H "Content-Type: application/json; charset=utf-8" \
            --data @payload.json \
            https://slack.com/api/chat.postMessage | jq .

